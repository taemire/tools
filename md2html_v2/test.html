<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TACHYON CLI v1.0.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap');

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.8;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 60px;
            color: #1a1a2e;
            background: #fff;
        }

        /* Cover */
        .cover {
            text-align: center;
            padding: 120px 0;
            border-bottom: 3px solid #3b82f6;
            margin-bottom: 60px;
            page-break-after: always;
        }

        .cover h1 {
            font-size: 32px;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .cover .subtitle {
            font-size: 28px;
            font-weight: 500;
            color: #475569;
            margin-bottom: 30px;
        }

        .cover .version {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 10px 30px;
            border-radius: 25px;
            font-size: 18px;
        }

        .cover .date {
            margin-top: 40px;
            color: #94a3b8;
        }

        .cover .company {
            margin-top: 80px;
            color: #475569;
            font-size: 18px;
        }

        /* TOC */
        .toc {
            background: #f8fafc;
            padding: 30px 40px;
            border-radius: 12px;
            margin: 40px 0;
            page-break-after: always;
        }

        .toc h2 {
            color: #1e40af;
            border: none;
            margin-bottom: 20px;
        }

        .toc ul {
            list-style: none;
            padding: 0;
        }

        .toc li {
            margin: 12px 0;
        }

        .toc a {
            color: #3b82f6;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        /* Headings */
        h1 {
            font-size: 28px;
            color: #1e40af;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 12px;
            margin-top: 50px;
        }

        h2 {
            font-size: 22px;
            color: #334155;
            margin-top: 40px;
            border-left: 4px solid #3b82f6;
            padding-left: 16px;
        }

        h3 {
            font-size: 18px;
            color: #475569;
            margin-top: 30px;
        }

        /* Code */
        code {
            font-family: 'JetBrains Mono', monospace;
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 14px;
            color: #be185d;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: break-all;
        }

        pre code {
            background: none;
            color: #e2e8f0;
            padding: 0;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            text-align: left;
            padding: 12px;
            border: 1px solid #e2e8f0;
        }

        td {
            padding: 12px;
            border: 1px solid #e2e8f0;
        }

        tr:nth-child(even) {
            background: #f8fafc;
        }

        /* Images */
        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 20px 0;
        }

        /* Alerts */
        blockquote {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 16px 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        /* Mermaid diagrams */
        .mermaid {
            text-align: center;
            margin: 20px 0;
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
        }

        /* Print */
        @media print {
            @page {
                size: A4;
                margin: 20mm 15mm 25mm 15mm;

                @bottom-center {
                    content: "TACHYON CLI v1.0.0";
                    font-size: 9pt;
                    color: #94a3b8;
                }

                @bottom-right {
                    content: counter(page);
                    font-size: 10pt;
                    color: #64748b;
                }
            }

            @page :first {
                @bottom-center {
                    content: none;
                }

                @bottom-right {
                    content: none;
                }
            }

            body {
                padding: 0;
                font-size: 11pt;
            }

            .cover {
                page-break-after: always;
            }

            h1,
            h2,
            h3,
            h4 {
                page-break-after: avoid;
                page-break-inside: avoid;
            }

            h1+*,
            h2+*,
            h3+*,
            h4+* {
                page-break-before: avoid;
            }

            pre,
            table,
            img,
            .mermaid {
                page-break-inside: avoid;
            }

            p,
            li {
                orphans: 3;
                widows: 3;
            }

            .footer {
                display: none;
            }
        }

        /* Section divider */
        .section {
            page-break-before: always;
        }

        .section:first-of-type {
            page-break-before: auto;
        }

        .footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            color: #94a3b8;
            font-size: 12px;
        }
    </style>
</head>

<body>

    <!-- Cover -->
    <div class="cover">
        <h1>TACHYON CLI</h1>
        
        <span class="version">Version 1.0.0</span>
        <p class="date">발행일: 2025년 12월 22일</p>
        <p class="company">장민석</p>
    </div>

    <!-- TOC -->
    <div class="toc">
        <h2>📋 목차</h2>
        <ul>
            
            <li><a href="#00_intro">1. 소개</a></li>
            
            <li><a href="#01_install">2. 1. 설치 및 설정</a></li>
            
            <li><a href="#02_usage">3. 2. 기본 사용법</a></li>
            
            <li><a href="#03_commands">4. 3. 주요 명령어</a></li>
            
            <li><a href="#04_shell">5. 4. 대화형 쉘 모드</a></li>
            
            <li><a href="#05_options">6. 5. 전역 옵션</a></li>
            
            <li><a href="#06_i18n">7. 6. 다국어 지원 (i18n)</a></li>
            
            <li><a href="#07_logging">8. 7. 로깅 시스템</a></li>
            
            <li><a href="#08_trouble">9. 8. 문제 해결</a></li>
            
        </ul>
    </div>

    <!-- Content -->
    
    <div class="section" id="00_intro">
        <h1 id="heading">소개</h1>
<p>TKCLI는 TACHYON 시스템을 효율적으로 관리하기 위한 통합 명령줄 도구입니다. 서비스 상태 점검, 데이터베이스 용량 확인, 시스템 정보 조회 등 다양한 관리 기능을 제공합니다.</p>

    </div>
    
    <div class="section" id="01_install">
        <h1 id="1---">1. 설치 및 설정</h1>
<h2 id="11---">1.1 설치 및 설정</h2>
<p><code>tkcli</code>는 단일 바이너리 형태로 배포됩니다. 시스템 환경에 맞는 바이너리를 다운로드하여 서버의 적절한 경로(예: <code>/usr/local/bin</code>)에 배치합니다.</p>
<h3 id="--">실행 권한 부여</h3>
<p>바이너리를 내려받은 후 반드시 실행 권한을 부여해야 합니다.</p>
<pre><code class="language-bash"># 실행 파일에 권한 부여 (예: /usr/local/bin 에 위치한 경우)
chmod +x /usr/local/bin/tkcli
</code></pre>
<h3 id="---">원클릭 환경 설정 (추천)</h3>
<p>권한 부여가 완료되면 다음 명령어를 실행하여 현재 사용 중인 셸(Bash, Zsh 등)에 <code>tkcli</code> 통합 설정을 자동으로 반영합니다.</p>
<pre><code class="language-bash">tkcli -i
</code></pre>
<p>이 명령어는 다음 작업을 수행합니다:</p>
<ul>
<li><strong>자동 완성 등록</strong>: 명령어 입력 시 <code>Tab</code> 키를 통한 자동 완성 기능 활성화</li>
<li><strong>셸 프로필 업데이트</strong>: <code>~/.bashrc</code> 또는 <code>~/.zshrc</code>에 필요한 환경 정보 추가</li>
</ul>
<h3 id="----1">자동 완성 자동 설치</h3>
<p>별도의 초기 설정을 진행하지 않고 <code>tkcli</code>를 처음 실행하면, 다음과 같이 Bash 자동 완성 기능을 설치할지 묻는 메시지가 나타납니다. <code>y</code>를 입력하면 자동으로 설치가 진행됩니다.</p>
<pre><code class="language-console">$ tkcli version

📝 Setting up bash completion for tkcli...
✓ Bash completion installed to /etc/bash_completion.d/tkcli
  Please restart your shell or run: source /etc/bash_completion.d/tkcli
✨ Setup complete! Completion will be available in new shell sessions.
</code></pre>
<h2 id="12--">1.2 구성 관리</h2>
<p><code>tkcli</code>는 실행 파일과 동일한 위치에 생성되는 <code>tkcli.ini</code> 파일을 통해 주요 설정을 관리합니다.</p>
<table>
<thead>
<tr>
<th style="text-align:left">설정 키</th>
<th style="text-align:left">설명</th>
<th style="text-align:left">기본값</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>basedir</strong></td>
<td style="text-align:left">TACHYON 설치 루트 경로</td>
<td style="text-align:left"><code>/usr/local/TACHYON/TTS40</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>admin_api_url</strong></td>
<td style="text-align:left">tkadmin 연동 서버 주소</td>
<td style="text-align:left"><code>http://127.0.0.1:13700</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>log_level</strong></td>
<td style="text-align:left">로그 기록 수준 (DEBUG, INFO, WARN, ERROR)</td>
<td style="text-align:left"><code>DEBUG</code></td>
</tr>
</tbody>
</table>
<h3 id="121-tkadmin---">1.2.1 tkadmin 연동 상세 로직</h3>
<p><code>tkcli</code>가 관리자 서버(<code>tkadmin</code>)로 작업 리포트를 보낼 때 사용하는 URL은 자동으로 구성됩니다.</p>
<ol>
<li>
<p><strong>연동 URL 결정 우선순위</strong>:</p>
<ul>
<li><strong>1순위</strong>: <code>tkcli.ini</code> 내의 <code>admin_api_url</code> 설정값.</li>
<li><strong>2순위 (자동 감지)</strong>: <code>tkcli</code> 실행 폴더에 <code>tkadmin.yml</code>이 존재할 경우, 해당 파일의 <code>port</code> 설정을 읽어 <code>http://127.0.0.1:{port}</code>로 자동 구성.</li>
<li><strong>3순위</strong>: 기본값 <code>http://127.0.0.1:13700</code> 사용.</li>
</ul>
</li>
<li>
<p><strong>통신 엔드포인트</strong>:</p>
<ul>
<li>실제 보고는 설정된 주소 뒤에 <code>/tkadmin/api/monitor/report</code> 경로가 자동으로 붙어 수행됩니다.</li>
<li>예: <code>admin_api_url</code>이 <code>http://192.168.0.100:13700</code>인 경우, 실제 통신 대상은 <code>http://192.168.0.100:13700/tkadmin/api/monitor/report</code>가 됩니다.</li>
</ul>
</li>
<li>
<p><strong>적용 시점</strong>:</p>
<ul>
<li>설정 변경 후 즉시 적용되며, 별도의 서비스 재시작은 필요하지 않습니다 (CLI 성격상 매 수행 시 설정을 로드함).</li>
</ul>
</li>
</ol>

    </div>
    
    <div class="section" id="02_usage">
        <h1 id="2--">2. 기본 사용법</h1>
<h2 id="21--">2.1 명령어 형식</h2>
<pre><code class="language-bash">tkcli [command] [subcommand] [arguments] [flags]
</code></pre>
<h2 id="22--">2.2 도움말 확인</h2>
<pre><code class="language-bash"># 전체 도움말
tkcli --help

# 특정 명령어 도움말
tkcli service --help
tkcli size --help
</code></pre>
<h2 id="23--">2.3 버전 확인</h2>
<pre><code class="language-bash"># 간단한 버전 정보
tkcli --version

#상세 버전 정보 (미들웨어 버전 포함)
tkcli version
</code></pre>
<h2 id="24-----env">2.4 환경 설정 및 진단 (env)</h2>
<p>SELinux, 시스템 리미트(<code>ulimit</code>) 등 시스템 환경 설정을 확인하고 최적화합니다.</p>
<pre><code class="language-bash"># SELinux 상태 확인
tkcli env selinux

# 시스템 및 서비스 리미트 상태 진단
tkcli env ulimit

# 권장 설정 자동 적용
tkcli env ulimit --set
</code></pre>

    </div>
    
    <div class="section" id="03_commands">
        <h1 id="3--">3. 주요 명령어</h1>
<h2 id="31---version">3.1 버전 정보 (version)</h2>
<p>TKCLI 및 관련 미들웨어의 버전 정보를 확인합니다.</p>
<h3 id="heading">사용법</h3>
<pre><code class="language-bash">tkcli version
</code></pre>
<h3 id="-">출력 예시</h3>
<pre><code>2025-12-07 16:02:37[INFO] ### TACHYON 서비스 버전 확인 ###
tkcli 버전: 0.1.0
-------------------------------------------------
MariaDB 버전: 10.11.2
NGINX 버전: 1.29.3
Redis 버전: 8.4.0
Kafka 버전: 3.4.0
Zookeeper 버전: 3.6.3
OpenSearch 버전: 2.19.4
OpenSearch-Dashboards 버전: 2.8.0
Logstash 버전: 
</code></pre>
<hr>
<h2 id="32---info">3.2 시스템 정보 (info)</h2>
<p>라이선스 정보, 시스템 리소스, 디스크 사용량, 서비스 상태를 한눈에 확인합니다.</p>
<h3 id="heading-1">사용법</h3>
<pre><code class="language-bash">tkcli info
</code></pre>
<h3 id="--1">출력 예시</h3>
<pre><code>2025-12-07 16:40:37[INFO] ### 시스템 정보 ###

라이선스 및 회사 정보
설치 회사명 : TSGroup
회사 코드      : 00133FKFKG
에이전트 수       : 100

시스템 리소스
총 메모리: 19 GB
여유 메모리: 1 GB

디스크 사용량
설치 디렉토리 크기
7.7G    /usr/local/TACHYON

데이터베이스 디렉토리
2.1G    /usr/local/TACHYON/TTS40/mariadb/data

OpenSearch 디렉토리
15G     /usr/local/TACHYON/TTS40/opensearch/opensearch/data

서비스 리소스 사용량
SERVICE                        STATUS     CPU(%)     MEMORY         
-----------------------------------------------------------------------
mariadb                        Active     0.1        279.74 MB      
redis                          Active     0.5        12.25 MB       
...
</code></pre>
<hr>
<h2 id="33---service">3.3 서비스 관리 (service)</h2>
<p>TACHYON 및 미들웨어 서비스의 상태를 확인하고 제어합니다.</p>
<h3 id="heading-2">사용법</h3>
<pre><code class="language-bash">tkcli service [action] [service_name]
</code></pre>
<h3 id="--">사용 가능한 액션</h3>
<ul>
<li><code>check</code>: 모든 서비스의 상태 확인</li>
<li><code>start &lt;service&gt;</code>: 서비스 시작</li>
<li><code>stop &lt;service&gt;</code>: 서비스 중지</li>
<li><code>restart &lt;service&gt;</code>: 서비스 재시작</li>
</ul>
<h3 id="--2">서비스 목록</h3>
<p><strong>미들웨어 서비스:</strong></p>
<ul>
<li><code>mariadb</code> - MariaDB 데이터베이스</li>
<li><code>redis</code> - Redis 캐시</li>
<li><code>nginx</code> - NGINX 웹 서버</li>
<li><code>zookeeper</code> - Zookeeper</li>
<li><code>kafka</code> - Kafka 메시지 브로커</li>
<li><code>opensearch</code> - OpenSearch 검색 엔진</li>
<li><code>opensearch-dashboards</code> - OpenSearch 대시보드</li>
<li><code>logstash-kafka-os</code> - Logstash</li>
</ul>
<p><strong>TACHYON 서비스:</strong></p>
<ul>
<li><code>TACHYON-Api1</code> - API 서버</li>
<li><code>TACHYON-Auth1</code> - 인증 서버</li>
<li><code>TACHYON-Manager1</code> - 관리 서버</li>
<li><code>TACHYON-Stat1</code> - 통계 서버</li>
<li><code>TACHYON-Report1</code> - 리포트 서버</li>
<li><code>TACHYON-Batch1</code> - 배치 서버</li>
<li><code>TACHYON-Watchdog1</code> - 감시 서버</li>
</ul>
<p><strong>특수 옵션:</strong></p>
<ul>
<li><code>all</code> - 모든 서비스 (순차적 시작/중지)</li>
</ul>
<h3 id="heading-3">예제</h3>
<pre><code class="language-bash"># 모든 서비스 상태 확인
tkcli service check

# 특정 서비스 시작
tkcli service start mariadb
tkcli service start TACHYON-Api1

# 모든 서비스 시작 (순차적 실행 워크플로우)
tkcli service start all

/* 실행 순서 상세 */

1. Level 1: 기본 인프라 (Infra)
   - zookeeper
   - redis
   - mariadb
   - opensearch
   - opensearch-dashboards
   (3초 대기)

2. Level 2: 메시징 (Kafka)
   - kafka
   (5초 대기 &amp; 연결 상태 검증)

3. Level 3: 로그 수집 및 웹 서버
   - logstash-kafka-os
   - nginx

4. Level 4: TACHYON API
   - TACHYON-Api* (발견된 모든 인스턴스: Api1, Api2...)
   (60초 대기 - API 초기화)

5. Level 5: TACHYON 서비스 로직
   - TACHYON-Auth*
   - TACHYON-Manager*
   - TACHYON-Stat*
   - TACHYON-Report*
   - TACHYON-Batch*
   (10초 대기)

6. Level 6: 감시 (Watchdog)
   - TACHYON-Watchdog*


# 특정 서비스 중지
tkcli service stop nginx

# 모든 서비스 중지 (역순 워크플로우)
tkcli service stop all
(Watchdog -&gt; Service Logic -&gt; API -&gt; Logs/Web -&gt; Kafka -&gt; Infra 순서로 안전하게 종료)
</code></pre>
<h3 id="--service-check">출력 예시 (service check)</h3>
<pre><code>2025-12-07 16:05:58[INFO] ### TACHYON 서비스 상태 점검 ###

서비스 리소스 사용량
SERVICE                        STATUS     CPU(%)     MEMORY         
-----------------------------------------------------------------------
mariadb                        Active     0.1        279.74 MB      
redis                          Active     0.5        12.25 MB       
zookeeper                      Active     0.2        122.36 MB      
kafka                          Active     7.2        1.07 GB        
opensearch                     Active     2.8        4.61 GB        
TACHYON-Api1                   Active     1.2        1.19 GB        
TACHYON-Batch1                 Active     5.7        1.08 GB        
TACHYON-Manager1               Active     1.4        1.25 GB        

2025-12-07 16:06:00[SUCC] 서비스 상태 확인 완료.
</code></pre>
<hr>
<h2 id="34---size">3.4 용량 확인 (size)</h2>
<p>MariaDB 테이블 및 OpenSearch 인덱스의 용량을 확인합니다.</p>
<h3 id="heading-4">사용법</h3>
<pre><code class="language-bash"># MariaDB 테이블 크기 확인
tkcli size tables [N]

# OpenSearch 인덱스 크기 확인
tkcli size opensearch [flags]

# 하위 호환성 (size tables와 동일)
tkcli size [N]
</code></pre>
<h3 id="mariadb--">MariaDB 테이블 크기</h3>
<pre><code class="language-bash"># 전체 테이블
tkcli size tables

# 상위 20개 테이블
tkcli size tables 20

# 하위 호환성
tkcli size 20
</code></pre>
<p><strong>출력 예시:</strong></p>
<pre><code>2025-12-08 15:17:36[INFO] ### MariaDB 테이블 용량 확인 (00133FKFKG) ###
2025-12-08 15:17:36[INFO] 🔎 상위 20 개 테이블을 표시합니다.

+---------------------------------+------------+------------+
| TABLE_NAME                      | TOTAL_SIZE | TABLE_ROWS |
+---------------------------------+------------+------------+
| TPU_ISTAT_MEDIA_EVENT_LOG       |    19.3 MB |     14,005 |
| TPU_INFO_DEPLOYING_DETAIL       |   960.0 KB |         17 |
| TPU_INFO_ENDPOINT_ISSUE_HISTORY |   960.0 KB |         15 |
| TPU_ISTAT_SYS_LOG               |   800.0 KB |        213 |
| TPU_INFO_SCHEDULE               |   720.0 KB |         15 |
| TPU_ISTAT_UMS_HISTORY_SUM       |   720.0 KB |         15 |
| TPU_ISTAT_MEDIA_BLOCK_SUM       |   720.0 KB |         15 |
| TPU_ISTAT_EVENT_LOG             |   704.0 KB |        306 |
| TPU_ISTAT_SYSTEM_SELF_TEST_LOG  |   592.0 KB |        441 |
| TPU_ISTAT_AGENT_INTEGRITY_LOG   |   528.0 KB |         95 |
+---------------------------------+------------+------------+
2025-12-08 15:17:36[SUCC] 테이블 용량 조회 완료.
</code></pre>
<p><strong>주요 기능:</strong></p>
<ul>
<li>MySQL 스타일 테이블 형식 출력</li>
<li>자동 단위 변환 (B/KB/MB/GB)</li>
<li>천 단위 콤마 표시 (14,005)</li>
<li>크기 기준 내림차순 정렬</li>
<li>동적 컬럼 너비 조정</li>
</ul>
<h3 id="opensearch--">OpenSearch 인덱스 크기</h3>
<pre><code class="language-bash"># 전체 인덱스 목록
tkcli size opensearch

# 월별 집계 (날짜 패턴 인덱스)
tkcli size opensearch -m
tkcli size opensearch --by-month
</code></pre>
<p><strong>출력 예시 (일반):</strong></p>
<pre><code>2025-12-08 15:17:47[INFO] OpenSearch Disk Usage Check...

+------------------------------+------------+------------+
| INDEX                        | TOTAL_SIZE | DOCS       |
+------------------------------+------------+------------+
| 00133fkfkg_2025_11           |     7.2 MB |     12,486 |
| 00133fkfkg_2025_12           |     3.4 MB |      4,713 |
| top_queries-2025.12.07-15367 |   507.1 KB |        199 |
| top_queries-2025.12.05-15365 |   481.5 KB |        293 |
| top_queries-2025.12.02-15362 |   476.7 KB |        277 |
| top_queries-2025.12.03-15363 |   443.9 KB |        692 |
| top_queries-2025.12.04-15364 |   424.2 KB |        191 |
| top_queries-2025.12.06-15366 |   328.1 KB |        402 |
| top_queries-2025.12.08-15368 |   258.3 KB |         25 |
| top_queries-2025.11.28-85639 |   196.2 KB |        211 |
| .opendistro_security         |    76.7 KB |         10 |
| .plugins-ml-config           |     4.5 KB |          1 |
| .kibana_1                    |      208 B |          0 |
| .opensearch-observability    |      208 B |          0 |
+------------------------------+------------+------------+
2025-12-08 15:17:47[SUCC] Check Complete.
</code></pre>
<p><strong>출력 예시 (월별 집계):</strong></p>
<pre><code>+------------------------------+------------+------------+
| MONTH                        | TOTAL_SIZE | DOCS       |
+------------------------------+------------+------------+
| 00133fkfkg_2025-11           |     7.2 MB |     12,486 |
| 00133fkfkg_2025-12           |     3.4 MB |      4,713 |
| 2025-12                      |     2.1 MB |      1,795 |
+------------------------------+------------+------------+
</code></pre>
<p><strong>주요 기능:</strong></p>
<ul>
<li>MariaDB와 동일한 MySQL 스타일 테이블 형식</li>
<li>자동 단위 변환 및 천 단위 콤마</li>
<li>크기 기준 내림차순 정렬</li>
<li>월별 집계 옵션 (<code>-m</code>, <code>--by-month</code>)</li>
</ul>
<hr>
<h2 id="35----admin">3.5 관리자 비밀번호 재설정 (admin)</h2>
<p>관리자 계정의 비밀번호를 초기화합니다.</p>
<h3 id="heading-5">사용법</h3>
<pre><code class="language-bash">tkcli admin &lt;USER_ID&gt;
</code></pre>
<h3 id="--3">초기화 비밀번호</h3>
<p><code>!TumsAdmin2025</code></p>
<h3 id="heading-6">예제</h3>
<pre><code># admin 계정 비밀번호 재설정
tkcli admin admin

# 특정 사용자 비밀번호 재설정
tkcli admin user123
</code></pre>
<h3 id="--4">출력 예시</h3>
<pre><code>2025-12-07 16:15:00[INFO] 사용자 ID 'admin'의 비밀번호를 업데이트합니다...
2025-12-07 16:15:01[SUCC] 사용자 'admin'의 비밀번호 업데이트를 완료했습니다.
2025-12-07 16:15:01[INFO] 새로운 비밀번호와 키가 설정되었습니다.
</code></pre>
<hr>
<h2 id="36---completion">3.6 자동 완성 (completion)</h2>
<p>다양한 셸에 대한 자동 완성 스크립트를 생성합니다.</p>
<h3 id="--5">지원 셸</h3>
<ul>
<li>Bash</li>
<li>Zsh</li>
<li>Fish</li>
</ul>
<h3 id="heading-7">사용법</h3>
<pre><code class="language-bash">tkcli completion [bash|zsh|fish|powershell]
</code></pre>
<h3 id="--6">설치 방법</h3>
<p><strong>Bash (Linux):</strong></p>
<pre><code class="language-bash"># 시스템 전역
tkcli completion bash | sudo tee /etc/bash_completion.d/tkcli

# 사용자별
tkcli completion bash &gt; ~/.local/share/bash-completion/completions/tkcli
</code></pre>
<p><strong>Bash (macOS):</strong></p>
<pre><code class="language-bash">tkcli completion bash &gt; $(brew --prefix)/etc/bash_completion.d/tkcli
</code></pre>
<p><strong>Zsh:</strong></p>
<pre><code class="language-bash"># Completion 활성화 (처음 한 번만)
echo &quot;autoload -U compinit; compinit&quot; &gt;&gt; ~/.zshrc

# Completion 스크립트 설치
tkcli completion zsh &gt; &quot;${fpath[1]}/_tkcli&quot;
</code></pre>
<p><strong>Fish:</strong></p>
<pre><code class="language-bash">tkcli completion fish &gt; ~/.config/fish/completions/tkcli.fish
</code></pre>
<hr>
<h2 id="37---update">3.7 서비스 업데이트 (update)</h2>
<p>TACHYON 시스템의 주요 미들웨어 서비스(Nginx, Redis, OpenSearch)를 업데이트합니다.
단순한 파일 교체가 아닌, <strong>버전 검증 시스템</strong>이 내장되어 있어 잘못된 버전 설치로 인한 시스템 장애를 방지합니다.</p>
<h3 id="heading-8">사용법</h3>
<pre><code class="language-bash">tkcli update [service] [flags]
</code></pre>
<h3 id="heading-9">옵션</h3>
<ul>
<li><code>--file</code>, <code>-f</code>: 업데이트할 패키지 파일(<code>.tar.gz</code>)의 경로를 지정합니다.</li>
<li><code>--force</code>: 버전 안전성 체크를 무시하고 강제로 업데이트를 진행합니다. (Downgrade 환경에서 유용)</li>
</ul>
<h3 id="--safety-guard">안전 장치 (Safety Guard)</h3>
<ol>
<li><strong>다운그레이드 차단</strong>: 설치하려는 패키지의 버전이 현재 시스템에 설치된 버전보다 낮을 경우 업데이트를 자동으로 중단합니다.</li>
<li><strong>메이저 버전 보호</strong>: 버전의 첫 번째 숫자(Major)가 다를 경우(예: v2 -&gt; v3) 경고를 출력하여 호환성 문제를 사전에 인지시킵니다.</li>
<li><strong>무결성 검사</strong>: 압축 해제 후 바이너리를 직접 실행하여 버전 정보를 추출하고 검증합니다.</li>
</ol>
<h3 id="---1">예제 (상세 로그)</h3>
<pre><code class="language-bash"># 정상적인 업그레이드 상황
tkcli update opensearch --file opensearch-2.19.4.tar.gz

# 출력 결과:
2025-12-20 12:16:34[INFO] 대상 서비스: opensearch, 파일: /root/packages/opensearch-2.19.4.tar.gz
2025-12-20 12:16:34[INFO] OpenSearch 업데이트를 시작합니다 (원본: /root/packages/opensearch-2.19.4.tar.gz)
2025-12-20 12:16:34[INFO] opensearch 서비스를 중지하는 중...
2025-12-20 12:16:34[INFO] 압축 해제 중...
2025-12-20 12:16:49[INFO] 버전 확인: [현재: 2.18.0] -&gt; [신규: 2.19.4]
2025-12-20 12:16:49[SUCC] 버전 업그레이드 확인: 2.18.0 -&gt; 2.19.4
2025-12-20 12:16:49[INFO] 파일 동기화 중(rsync)...
2025-12-20 12:16:53[INFO] opensearch 서비스를 시작하는 중...
2025-12-20 12:16:54[SUCC] OpenSearch 업데이트를 성공적으로 마쳤습니다.
</code></pre>
<pre><code class="language-bash"># 강제 복구(Downgrade)가 필요한 상황
tkcli update opensearch --file opensearch-2.19.4.tar.gz --force

# 출력 결과:
2025-12-20 12:24:49[INFO] 버전 확인: [현재: 3.4.0] -&gt; [신규: 2.19.4]
2025-12-20 12:24:49[WARN] 치명적: 메이저 버전 불일치! 호환성 문제가 발생할 수 있습니다.
2025-12-20 12:24:49[WARN] --force 플래그에 의해 안전 검사를 건너뜜니다. 이전 버전으로 진행합니다 (2.19.4 &lt; 3.4.0).
2025-12-20 12:24:49[INFO] 파일 동기화 중(rsync)...
2025-12-20 12:24:54[SUCC] OpenSearch 업데이트를 성공적으로 마쳤습니다.
</code></pre>
<hr>
<h2 id="38----update-package">3.8 배포용 패키지 생성 (update package)</h2>
<p>전문 엔지니어가 폐쇄망 환경 배포를 위해 최신 버전의 미들웨어를 다운로드, 컴파일 및 패키징하는 전문 기능을 제공합니다. 이 기능은 운영 환경의 <strong>호환성을 유지</strong>하기 위해 현재 설치된 메이저 버전을 추적합니다.</p>
<h3 id="heading-10">특징</h3>
<ul>
<li><strong>메이저 버전 보호</strong>: 현재 v1.x를 사용 중이라면 v2.x가 출시되어도 v1.x 계열의 최신 패치 버전을 자동으로 찾아 패키징합니다.</li>
<li><strong>의존성 자동 해결</strong>: Nginx 빌드 시 필요한 PCRE2, OpenSSL, Zlib 등의 라이브러리를 소스와 함께 자동으로 다운로드하여 정적 빌드합니다.</li>
<li><strong>표준화된 파일명</strong>: <code>nginx-1.29.4.tar.gz</code>와 같이 버전이 명시된 파일명으로 패키지를 생성합니다.</li>
</ul>
<h3 id="heading-11">예제</h3>
<pre><code class="language-bash"># Nginx 최신 패치 패키지 생성
tkcli update package nginx

# 출력 결과:
2025-12-20 12:12:40[INFO] 인터넷 연결 확인 중...
2025-12-20 12:12:41[SUCC] 인터넷 연결이 확인되었습니다.
2025-12-20 12:12:41[INFO] 현재 설치된 버전: 1.29.3 (메이저: 1)
2025-12-20 12:12:41[INFO] nginx의 최신 안정 버전을 감지하는 중 (메이저 1 필터링)...
2025-12-20 12:12:42[INFO] 대상 버전(1.29.4)이 현재(1.29.3)보다 최신입니다. 패키지 업데이트를 권장합니다.
2025-12-20 12:12:43[INFO]   - 의존성 다운로드 중: pcre2-10.45
2025-12-20 12:12:48[INFO]   - 설정 중 (configure): --with-pcre=../pcre2-10.45 ...
2025-12-20 12:12:53[INFO]   - 컴파일 중...
2025-12-20 12:14:25[SUCC] 패키지가 성공적으로 생성되었습니다: /root/dist/packages/nginx-1.29.4.tar.gz
</code></pre>
<h3 id="--7">참고 사항</h3>
<ul>
<li>이 명령어는 <strong>인터넷 연결이 활성화</strong>된 환경(예: 개발 서버, 인터넷 가능 운영 서버)에서 실행해야 합니다.</li>
<li>생성된 패키지는 폐쇄망 서버로 복사한 후 <code>tkcli update</code> 명령어를 통해 설치할 수 있습니다.</li>
</ul>
<hr>
<h2 id="39---env">3.9 환경 설정 (env)</h2>
<p>SELinux 상태, 시스템 전역 리미트(<code>ulimit</code>), 각 서비스별 개별 리미트 구성 및 방화벽(<code>Firewall</code>) 상태를 확인하고 최적화합니다.</p>
<h3 id="heading-12">사용법</h3>
<pre><code class="language-bash"># 전체 환경 정보 확인 (SELinux + ulimit + Firewall)
tkcli env

# SELinux 상태 확인 및 설정
tkcli env selinux [--set mode]

# 시스템/서비스 리미트(ulimit) 확인 및 설정
tkcli env ulimit [--set value]

# 방화벽(Firewall) 상태 확인
tkcli env firewall
</code></pre>
<h3 id="selinux----">SELinux 상태 확인 및 최적화</h3>
<p>SELinux의 현재 실행 모드(런타임)와 <code>/etc/selinux/config</code>에 저장된 영구 설정을 동시에 확인하며, TACHYON 운영에 최적화된 <code>disabled</code> 모드로 간편하게 전환할 수 있습니다.</p>
<p><strong>사용 예시:</strong></p>
<pre><code class="language-bash"># 상태 확인
tkcli env selinux

# 권장값(disabled)으로 자동 설정
tkcli env selinux --set

# 특정 모드로 설정
tkcli env selinux --set=permissive
</code></pre>
<p><strong>설정 로직 특징:</strong></p>
<ul>
<li>이미 대상 모드로 설정되어 있는 경우, 불필요한 변경 작업을 생략합니다.</li>
<li><code>disabled</code> 모드 설정 시 즉시 효과를 위해 <code>permissive</code>를 먼저 적용하고, 영구 설정을 변경합니다 (재부팅 안내 포함).</li>
</ul>
<hr>
<h3 id="ulimit---">리미트(ulimit) 진단 및 최적화</h3>
<p>시스템 전역 설정(<code>/etc/security/limits.conf</code>)과 각 systemd 서비스별로 실제로 적용된 <code>LimitNOFILE</code> 값을 한눈에 비교 분석합니다.</p>
<p><strong>사용 예시:</strong></p>
<pre><code class="language-bash"># 시스템 및 전 서비스 리미트 상태 진단
tkcli env ulimit

# 권장값(65535)으로 시스템 리미트 자동 설정
tkcli env ulimit --set

# 특정 값으로 시스템 리미트 설정
tkcli env ulimit --set=99999
</code></pre>
<p><strong>진단 항목:</strong></p>
<ol>
<li><strong>시스템 전역 설정</strong>: <code>/etc/security/limits.conf</code> 파싱 결과.</li>
<li><strong>서비스별 적용 값</strong>: <code>systemctl show</code> 명령을 통해 실제 프로세스에 할당된 <code>LimitNOFILE</code> 값 추출.
<ul>
<li>설정이 누락되거나 너무 낮은 경우 <code>WARN</code> 상태로 표시하여 장애를 예방합니다.</li>
</ul>
</li>
</ol>
<p><strong>출력 예시:</strong></p>
<pre><code>  [ 시스템 전체 설정 (/etc/security/limits.conf) ]
+----------------------+------------+------------+------------+
| 대상 (Domain)        | 유형       | 항목       | 값         |
+----------------------+------------+------------+------------+
| *                    | soft       | nofile     | 65535      |
| *                    | hard       | nofile     | 65535      |
+----------------------+------------+------------+------------+

  [ 서비스별 개별 설정 (systemd LimitNOFILE) ]
+--------------------------------+----------------------+-----------------+
| 서비스명                       | 리미트 (NOFILE)      | 상태            |
+--------------------------------+----------------------+-----------------+
| mariadb                        | 65535                | OK              |
| TACHYON-Api1                   | 524288               | OK              |
| TACHYON-Watchdog1              | Not Set              | WARN            |
+--------------------------------+----------------------+-----------------+
</code></pre>
<hr>
<h3 id="firewall-">방화벽(Firewall) 진단</h3>
<p>시스템의 방화벽 서비스 활성 여부와 현재 오픈된 주요 포트 및 서비스를 한눈에 확인합니다.</p>
<p><strong>사용 예시:</strong></p>
<pre><code class="language-bash"># 방화벽 상태 및 오픈 포트 진단
tkcli env firewall

# 방화벽 기본 최적화 (SSH, 443 허용)
tkcli env firewall --set

# 특정 포트 허용
tkcli env firewall --set 8080
</code></pre>
<p><strong>진단 및 설정 항목:</strong></p>
<ol>
<li><strong>방화벽 유무 및 상태</strong>: <code>firewalld</code> 및 <code>iptables</code> 서비스의 설치 및 활성화(<code>Active</code>) 여부 확인.</li>
<li><strong>오픈 포트 목록</strong>: <code>firewalld</code> 기준으로 현재 접근 가능한 모든 포트 및 서비스 정보 추출.</li>
<li><strong>자동 설정 (<code>--set</code>)</strong>:
<ul>
<li><strong>인자 생략/default</strong>: SSH 서비스와 TACHYON 메인 포트(443)를 자동으로 허용합니다. (SSH는 실제 시스템 바인드 포트를 감지하여 처리)</li>
<li><strong>포트 지정</strong>: 입력한 포트 번호를 <code>tcp</code> 프로토콜로 개방합니다.</li>
</ul>
</li>
</ol>
<p><strong>출력 예시:</strong></p>
<pre><code>  [ 방화벽 상태 ]
+----------------------+----------------------+
| 서비스/존            | 상태                 |
+----------------------+----------------------+
| firewalld            | 활성 (Active)        |
| iptables             | 비활성 (Inactive)    |
+----------------------+----------------------+

  [ 현재 오픈된 주요 포트 (TACHYON 관련) ]
+-----------------+-----------------+---------------------------+
| 포트            | 프로토콜        | 서비스/존                 |
+-----------------+-----------------+---------------------------+
| 3306            | tcp             | firewalld (port)          |
| 13700-13710     | tcp             | firewalld (port)          |
| As Defined      | Mixed           | ssh                       |
| As Defined      | Mixed           | dhcpv6-client             |
+-----------------+-----------------+---------------------------+
</code></pre>
<hr>
<h3 id="-----set--">환경 설정 플래그 (<code>--set</code>) 공통 규칙</h3>
<p><code>--set</code> (또는 <code>-s</code>) 옵션은 인자 생략 시 각 환경에 맞는 <strong>TACHYON 권장값</strong>을 자동으로 선택합니다.</p>
<table>
<thead>
<tr>
<th style="text-align:left">환경 (Type)</th>
<th style="text-align:left">기본 권장값 (Default)</th>
<th style="text-align:left">설명</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>selinux</code></td>
<td style="text-align:left"><code>disabled</code></td>
<td style="text-align:left">보안 정책에 의한 서비스 차단 방지</td>
</tr>
<tr>
<td style="text-align:left"><code>ulimit</code></td>
<td style="text-align:left"><code>65535</code></td>
<td style="text-align:left">&quot;Too many open files&quot; 장애 예방</td>
</tr>
<tr>
<td style="text-align:left"><code>firewall</code></td>
<td style="text-align:left"><code>default</code></td>
<td style="text-align:left">SSH 및 443(TACHYON) 포트 자동 허용</td>
</tr>
</tbody>
</table>
<blockquote>
<div class="alert-title">주의</div><p class="alert-body">시스템 리미트 설정은 <code>/etc/security/limits.conf</code>를 수정하므로, 변경 사항을 적용하려면 <strong>로그아웃 후 다시 로그인</strong>하거나 시스템을 재시작해야 합니다.</p>
</blockquote>
<hr>
<h2 id="310---logrotate">3.10 로그 로테이션 (logrotate)</h2>
<p>TACHYON 및 미들웨어 서비스의 로그 로테이션 설정 상태를 확인하고, 누락된 설정을 자동으로 구성합니다.</p>
<h3 id="heading-13">사용법</h3>
<pre><code class="language-bash"># 전체 서비스 로그 로테이션 상태 확인
tkcli logrotate

# 특정 서비스 로그 로테이션 상태 확인
tkcli logrotate [service]

# 누락된 서비스에 대해 로그 로테이션 자동 설정
tkcli logrotate --set

# 특정 서비스 로그 로테이션 설정
tkcli logrotate [service] --set
</code></pre>
<h3 id="--8">지원 서비스</h3>
<p><strong>미들웨어:</strong></p>
<ul>
<li><code>nginx</code> - NGINX 로그 로테이션</li>
<li><code>redis</code> - Redis 로그 로테이션</li>
<li><code>opensearch</code> - OpenSearch 로그 (내부 관리)</li>
<li><code>kafka</code> - Kafka 로그 (내부 관리)</li>
<li><code>logstash</code> - Logstash 로그 (내부 관리)</li>
<li><code>mariadb</code> - MariaDB 로그 (내부 관리)</li>
</ul>
<p><strong>TACHYON 서비스:</strong></p>
<ul>
<li><code>api</code>, <code>auth</code>, <code>manager</code>, <code>stat</code>, <code>batch</code>, <code>report</code>, <code>watchdog</code> - Java 서비스 (Log4j2 내부 관리)</li>
</ul>
<p><strong>관리 도구:</strong></p>
<ul>
<li><code>tkadmin</code> - 관리자 도구 (tkadmin.yml 설정 기반)</li>
<li><code>tkcli</code> - CLI 도구 (자체 로테이션)</li>
</ul>
<h3 id="---">출력 예시 (상태 확인)</h3>
<pre><code>2025-12-21 20:00:00[INFO] ### 서비스 로그 로테이션 상태 확인 ###

+---------------+------------+------------+------------+------------+
| 서비스        | 유형       | 로테이션   | 압축       | 상태       |
+---------------+------------+------------+------------+------------+
| nginx         | logrotate  | daily/7    | yes        | OK         |
| redis         | logrotate  | daily/7    | yes        | OK         |
| opensearch    | internal   | size-based | yes        | OK         |
| kafka         | internal   | size-based | N/A        | OK         |
| logstash      | internal   | daily      | N/A        | OK         |
| mariadb       | internal   | size-based | N/A        | OK         |
| Api1          | log4j2     | daily/30   | yes        | OK         |
| Auth1         | log4j2     | daily/30   | yes        | OK         |
| Manager1      | log4j2     | daily/30   | yes        | OK         |
| tkadmin       | internal   | 100MB/30d  | yes        | OK         |
| tkcli         | internal   | daily/7    | N/A        | OK         |
+---------------+------------+------------+------------+------------+

2025-12-21 20:00:00[SUCC] 로그 로테이션 상태 확인 완료.

  ✅ 모든 서비스의 로그 로테이션이 정상입니다.
</code></pre>
<h3 id="---2">로테이션 유형 설명</h3>
<table>
<thead>
<tr>
<th style="text-align:left">유형</th>
<th style="text-align:left">설명</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>logrotate</code></td>
<td style="text-align:left">시스템 logrotate 데몬 사용 (<code>/etc/logrotate.d/</code>)</td>
</tr>
<tr>
<td style="text-align:left"><code>log4j2</code></td>
<td style="text-align:left">Java Log4j2 내부 롤링 정책 사용</td>
</tr>
<tr>
<td style="text-align:left"><code>internal</code></td>
<td style="text-align:left">서비스 자체 내장 로테이션 메커니즘 사용</td>
</tr>
</tbody>
</table>
<h3 id="---3">자동 설정 예시</h3>
<pre><code class="language-bash"># 누락된 서비스에 대해 로그 로테이션 자동 설정
tkcli logrotate --set

# 출력 결과:
2025-12-21 20:05:00[INFO] ### 로그 로테이션 설정 적용 ###
2025-12-21 20:05:00[INFO] redis: 로그 로테이션 설정 중...
2025-12-21 20:05:01[SUCC] redis 로그 로테이션이 성공적으로 설정되었습니다.
2025-12-21 20:05:01[INFO] nginx: 이미 설정되어 있습니다.
2025-12-21 20:05:01[INFO] tkadmin: 자체 로테이션으로 관리되는 서비스입니다
2025-12-21 20:05:01[SUCC] 로그 로테이션 설정이 완료되었습니다.
</code></pre>
<h3 id="--9">설정 내용</h3>
<p><code>--set</code> 옵션으로 자동 설정 시 다음과 같은 logrotate 설정이 적용됩니다:</p>
<pre><code># /etc/logrotate.d/tachyon-redis
/usr/local/TACHYON/TTS40/redis/logs/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
    postrotate
        /bin/kill -HUP `cat /var/run/redis/redis.pid 2&gt;/dev/null` 2&gt;/dev/null || true
    endscript
}
</code></pre>
<h3 id="--10">서비스별 특이사항</h3>
<table>
<thead>
<tr>
<th style="text-align:left">서비스</th>
<th style="text-align:left">특징</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>OpenSearch</strong></td>
<td style="text-align:left">내부 Rolling Policy 사용. 별도 설정 불필요.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Kafka</strong></td>
<td style="text-align:left"><code>log.retention.hours</code>, <code>log.segment.bytes</code> 설정으로 내부 관리됨.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Java 서비스</strong></td>
<td style="text-align:left"><code>log4j2.xml</code>의 <code>RollingRandomAccessFile</code> 정책 사용.</td>
</tr>
<tr>
<td style="text-align:left"><strong>tkadmin</strong></td>
<td style="text-align:left"><code>tkadmin.yml</code>의 <code>logging.max_size</code>, <code>logging.max_age</code> 설정 사용.</td>
</tr>
<tr>
<td style="text-align:left"><strong>tkcli</strong></td>
<td style="text-align:left">내부 <code>LogMaxAge</code> 상수에 따라 7일간 보관 후 자동 삭제.</td>
</tr>
</tbody>
</table>
<blockquote>
<div class="alert-title">참고</div><p class="alert-body">내부적으로 로그 관리를 수행하는 서비스(<code>internal</code>, <code>log4j2</code>)는 <code>--set</code> 옵션을 사용해도 별도의 시스템 logrotate 설정을 생성하지 않습니다.</p>
</blockquote>

    </div>
    
    <div class="section" id="04_shell">
        <h1 id="4---">4. 대화형 쉘 모드</h1>
<p>인자 없이 <code>tkcli</code>를 실행하면 대화형 쉘 모드로 진입합니다.</p>
<h2 id="41-">4.1 실행</h2>
<pre><code class="language-console">$ tkcli
tkcli&gt;
</code></pre>
<h2 id="42--">4.2 주요 기능</h2>
<h3 id="tab-completion">Tab Completion</h3>
<p>명령어 및 서비스명 자동 완성을 지원합니다.</p>
<pre><code class="language-console">tkcli&gt; service &lt;TAB&gt;&lt;TAB&gt;
start  stop   check

tkcli&gt; service start &lt;TAB&gt;&lt;TAB&gt;
all              nginx            mariadb          redis
TACHYON-Api1     TACHYON-Web1     TACHYON-Worker1
</code></pre>
<h3 id="history">History</h3>
<p>위/아래 방향키로 이전 명령어를 탐색할 수 있습니다.</p>
<h3 id="signal-handling">Signal Handling</h3>
<p>실행 중인 명령어를 <code>Ctrl+C</code>로 중단해도 쉘은 종료되지 않습니다.</p>
<pre><code class="language-console">tkcli&gt; service start all
^C
명령어가 취소되었습니다.
tkcli&gt;
</code></pre>
<h3 id="heading">종료</h3>
<p>다음 방법으로 쉘을 종료할 수 있습니다:</p>
<ul>
<li><code>exit</code> 입력</li>
<li><code>quit</code> 입력</li>
<li><code>Ctrl+D</code> (EOF)</li>
</ul>
<h2 id="43--">4.3 사용 예시</h2>
<pre><code class="language-console">$ tkcli
tkcli&gt; version
tkcli 버전: 0.1.0
...

tkcli&gt; service check
### TACHYON 서비스 상태 확인 ###
...

tkcli&gt; size opensearch -m
MONTH (Aggregated)...
...

tkcli&gt; exit
</code></pre>

    </div>
    
    <div class="section" id="05_options">
        <h1 id="5--">5. 전역 옵션</h1>
<p>모든 명령어에서 사용 가능한 전역 옵션입니다.</p>
<h2 id="51------basedir--b">5.1 기본 디렉토리 설정 (<code>--basedir</code>, <code>-b</code>)</h2>
<p>기본 설치 경로가 아닌 다른 경로를 사용할 경우 설정합니다.<br>
설정값은 <code>tkcli.ini</code> 파일에 영구적으로 저장됩니다.</p>
<pre><code class="language-bash"># 경로 변경 및 저장
tkcli -b /custom/path info

# 또는
tkcli --basedir=/custom/path info
</code></pre>
<h2 id="52------verbose--v">5.2 상세 출력 모드 (<code>--verbose</code>, <code>-v</code>)</h2>
<p>디버깅을 위한 상세 출력을 활성화합니다.</p>
<pre><code class="language-bash">tkcli -v service check
tkcli --verbose info
</code></pre>
<h2 id="53-----uninstall--u">5.3 설정 제거 (<code>--uninstall</code>, <code>-u</code>)</h2>
<p>TKCLI가 설치한 자동 완성 스크립트와 설정 파일을 제거합니다.</p>
<pre><code class="language-bash">tkcli --uninstall
# 또는
tkcli -u
</code></pre>
<p><strong>제거 대상:</strong></p>
<ul>
<li>Bash completion 스크립트 (<code>/etc/bash_completion.d/tkcli</code> 등)</li>
<li>Completion 체크 플래그 파일 (<code>~/.tkcli_completion_checked</code>)</li>
<li>레거시 <code>.bashrc</code> 설정 블록</li>
</ul>
<h2 id="54-----version">5.4 버전 정보 (<code>--version</code>)</h2>
<p>간단한 버전 정보를 출력합니다.</p>
<pre><code class="language-bash">tkcli --version
# 출력: version 0.1.0
</code></pre>

    </div>
    
    <div class="section" id="06_i18n">
        <h1 id="6---i18n">6. 다국어 지원 (i18n)</h1>
<p>TKCLI는 시스템의 언어 설정을 자동으로 감지하여 다국어를 지원합니다.</p>
<h2 id="61---">6.1 자동 언어 감지</h2>
<p>시스템의 <code>LANG</code> 또는 <code>LC_ALL</code> 환경 변수를 감지합니다.</p>
<pre><code class="language-bash"># 영문 환경
LANG=en_US.UTF-8 tkcli info
# → 영어 출력

# 한글 환경
LANG=ko_KR.UTF-8 tkcli info
# → 한국어 출력

# 일본어 환경
LANG=ja_JP.UTF-8 tkcli info
# → 일본어 출력 (언어팩이 있는 경우)
</code></pre>
<h2 id="62--">6.2 내장 언어팩</h2>
<ul>
<li><strong>영어 (en)</strong>: 기본 언어</li>
<li><strong>한국어 (ko)</strong>: 완전 번역</li>
</ul>
<h2 id="63---">6.3 사용자 정의 언어팩</h2>
<p>TKCLI 실행 경로에 <code>lang</code> 디렉토리를 만들고 JSON 파일을 추가하면 새로운 언어를 지원할 수 있습니다.</p>
<h3 id="--">언어팩 생성 절차</h3>
<ol>
<li>
<p><strong>디렉토리 생성</strong></p>
<pre><code class="language-bash">mkdir lang
</code></pre>
</li>
<li>
<p><strong>언어팩 파일 생성</strong></p>
<pre><code class="language-bash">vim lang/ja.json
</code></pre>
</li>
<li>
<p><strong>JSON 작성</strong></p>
<pre><code class="language-json">{
  &quot;meta&quot;: {
    &quot;version&quot;: &quot;1.0&quot;,
    &quot;compatibility&quot;: &quot;0.1.0&quot;
  },
  &quot;messages&quot;: {
    &quot;root_short&quot;: &quot;TACHYON CLI - システム管理ツール&quot;,
    &quot;info_title&quot;: &quot;### TACHYON システム情報 ###&quot;,
    &quot;service_check_title&quot;: &quot;### TACHYON サービス状態チェック ###&quot;
  }
}
</code></pre>
</li>
<li>
<p><strong>실행</strong></p>
<pre><code class="language-bash">LANG=ja_JP.UTF-8 ./tkcli info
</code></pre>
</li>
</ol>
<h3 id="---1">표준 언어팩 파일명</h3>
<table>
<thead>
<tr>
<th>언어</th>
<th>파일명</th>
<th>환경 변수 예시</th>
</tr>
</thead>
<tbody>
<tr>
<td>영어</td>
<td><code>en.json</code></td>
<td><code>en_US.UTF-8</code></td>
</tr>
<tr>
<td>한국어</td>
<td><code>ko.json</code></td>
<td><code>ko_KR.UTF-8</code></td>
</tr>
<tr>
<td>일본어</td>
<td><code>ja.json</code></td>
<td><code>ja_JP.UTF-8</code></td>
</tr>
<tr>
<td>중국어 (간체)</td>
<td><code>zh-cn.json</code></td>
<td><code>zh_CN.UTF-8</code></td>
</tr>
<tr>
<td>중국어 (번체)</td>
<td><code>zh-tw.json</code></td>
<td><code>zh_TW.UTF-8</code></td>
</tr>
<tr>
<td>프랑스어</td>
<td><code>fr.json</code></td>
<td><code>fr_FR.UTF-8</code></td>
</tr>
<tr>
<td>독일어</td>
<td><code>de.json</code></td>
<td><code>de_DE.UTF-8</code></td>
</tr>
<tr>
<td>스페인어</td>
<td><code>es.json</code></td>
<td><code>es_ES.UTF-8</code></td>
</tr>
<tr>
<td>러시아어</td>
<td><code>ru.json</code></td>
<td><code>ru_RU.UTF-8</code></td>
</tr>
</tbody>
</table>
<h2 id="64--">6.4 폴백 메커니즘</h2>
<ul>
<li>요청한 언어의 키가 없으면 자동으로 영어로 폴백됩니다.</li>
<li>언어팩 파일이 없으면 영어가 사용됩니다.</li>
</ul>

    </div>
    
    <div class="section" id="07_logging">
        <h1 id="7--">7. 로깅 시스템</h1>
<p>TKCLI는 자체 로그를 파일에 기록하며, TACHYON 운영 서비스의 로그 로테이션 상태를 확인하고 관리하는 기능을 제공합니다.</p>
<h2 id="71-tkcli--">7.1 TKCLI 자체 로깅</h2>
<h3 id="---">로그 파일 위치 (우선순위)</h3>
<ol>
<li><code>/usr/local/TACHYON/TTS40/logs/tkcli_YYYYMMDD.log</code> (기본)</li>
<li><code>~/.tkcli/logs/tkcli_YYYYMMDD.log</code> (권한 없을 시)</li>
<li><code>/tmp/tkcli_logs/tkcli_YYYYMMDD.log</code> (최종 대체)</li>
</ol>
<h3 id="--">로그 레벨 설정</h3>
<p><code>tkcli.ini</code> 파일에서 로그 레벨을 설정할 수 있습니다.</p>
<p><strong>설정 파일 위치:</strong></p>
<ul>
<li>TKCLI 실행 경로의 <code>tkcli.ini</code></li>
</ul>
<p><strong>설정 예시:</strong></p>
<pre><code class="language-ini">basedir=/usr/local/TACHYON/TTS40
log_level=INFO
verbose=false
</code></pre>
<p><strong>로그 레벨:</strong></p>
<ul>
<li><code>DEBUG</code>: 모든 로그 기록 (개발/디버깅용)</li>
<li><code>INFO</code>: 일반 정보 및 상태 변경 (기본값)</li>
<li><code>WARN</code>: 경고 메시지만</li>
<li><code>ERROR</code>: 오류만 기록</li>
</ul>
<h3 id="-">로그 확인</h3>
<pre><code class="language-bash"># 오늘 로그 확인
tail -f /usr/local/TACHYON/TTS40/logs/tkcli_$(date +%Y%m%d).log

# 최근 100줄
tail -100 /usr/local/TACHYON/TTS40/logs/tkcli_$(date +%Y%m%d).log

# 특정 날짜 로그
cat /usr/local/TACHYON/TTS40/logs/tkcli_20251207.log
</code></pre>
<h3 id="---1">로그 보관 정책</h3>
<p>TKCLI 자체 로그는 <strong>7일간 보관</strong> 후 자동으로 삭제됩니다. 이 정책은 내부 <code>LogMaxAge</code> 상수로 관리됩니다.</p>
<hr>
<h2 id="72-----logrotate-">7.2 서비스 로그 로테이션 관리 (logrotate 명령어)</h2>
<p>TACHYON 운영 환경에서는 다양한 미들웨어와 서비스가 로그를 생성합니다. <code>tkcli logrotate</code> 명령어를 통해 모든 서비스의 로그 로테이션 상태를 한눈에 확인하고, 필요시 자동으로 설정할 수 있습니다.</p>
<h3 id="--1">빠른 사용법</h3>
<pre><code class="language-bash"># 전체 서비스 로그 로테이션 상태 확인
tkcli logrotate

# 특정 서비스만 확인
tkcli logrotate nginx

# 누락된 설정 자동 적용
tkcli logrotate --set
</code></pre>
<h3 id="--2">지원 서비스</h3>
<table>
<thead>
<tr>
<th style="text-align:left">서비스 유형</th>
<th style="text-align:left">서비스 목록</th>
<th style="text-align:left">로테이션 방식</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>미들웨어</strong></td>
<td style="text-align:left">nginx, redis</td>
<td style="text-align:left">시스템 logrotate</td>
</tr>
<tr>
<td style="text-align:left"><strong>미들웨어</strong></td>
<td style="text-align:left">opensearch, kafka, logstash, mariadb</td>
<td style="text-align:left">내부 관리</td>
</tr>
<tr>
<td style="text-align:left"><strong>TACHYON</strong></td>
<td style="text-align:left">Api, Auth, Manager, Stat, Batch, Report, Watchdog</td>
<td style="text-align:left">Log4j2</td>
</tr>
<tr>
<td style="text-align:left"><strong>관리 도구</strong></td>
<td style="text-align:left">tkadmin</td>
<td style="text-align:left">tkadmin.yml 설정</td>
</tr>
<tr>
<td style="text-align:left"><strong>관리 도구</strong></td>
<td style="text-align:left">tkcli</td>
<td style="text-align:left">자체 로테이션</td>
</tr>
</tbody>
</table>
<h3 id="--3">상세 사용법</h3>
<p>자세한 사용법과 출력 예시는 <a href="/03_commands.md#310-%EB%A1%9C%EA%B7%B8-%EB%A1%9C%ED%85%8C%EC%9D%B4%EC%85%98-logrotate">주요 명령어 - 3.10 로그 로테이션</a> 섹션을 참조하세요.</p>
<hr>
<h2 id="73---">7.3 서비스별 로그 위치</h2>
<table>
<thead>
<tr>
<th style="text-align:left">서비스</th>
<th style="text-align:left">로그 경로</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>TKCLI</strong></td>
<td style="text-align:left"><code>$BASEDIR/logs/tkcli_YYYYMMDD.log</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>tkadmin</strong></td>
<td style="text-align:left"><code>$BASEDIR/tkadmin/logs/</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>NGINX</strong></td>
<td style="text-align:left"><code>$BASEDIR/nginx/logs/</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>Redis</strong></td>
<td style="text-align:left"><code>$BASEDIR/redis/logs/</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>OpenSearch</strong></td>
<td style="text-align:left"><code>$BASEDIR/opensearch/opensearch/logs/</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>Kafka</strong></td>
<td style="text-align:left"><code>$BASEDIR/kafka/logs/</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>Java 서비스</strong></td>
<td style="text-align:left"><code>$BASEDIR/logs/[ServiceName]/</code></td>
</tr>
</tbody>
</table>
<blockquote>
<div class="alert-title">참고</div><p class="alert-body"><code>$BASEDIR</code>은 기본적으로 <code>/usr/local/TACHYON/TTS40</code>입니다.</p>
</blockquote>

    </div>
    
    <div class="section" id="08_trouble">
        <h1 id="8--">8. 문제 해결</h1>
<h2 id="81--">8.1 일반적인 문제</h2>
<h3 id="---">명령어를 찾을 수 없음</h3>
<pre><code class="language-bash"># PATH 확인
echo $PATH

# tkcli 위치 확인
which tkcli

# PATH에 추가 (임시)
export PATH=$PATH:/usr/local/bin

# PATH에 추가 (영구)
echo 'export PATH=$PATH:/usr/local/bin' &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre>
<h3 id="-">권한 오류</h3>
<pre><code class="language-bash"># 실행 권한 부여
chmod +x tkcli

# 소유권 변경
sudo chown $USER:$USER tkcli
</code></pre>
<h3 id="--">데이터베이스 연결 실패</h3>
<pre><code class="language-bash"># MariaDB 상태 확인
tkcli service check | grep mariadb

# MariaDB 시작
tkcli service start mariadb

# 연결 테스트
mysql -u root -p
</code></pre>
<h2 id="82----">8.2 자동 완성이 작동하지 않음</h2>
<pre><code class="language-bash"># Completion 재설치
tkcli completion bash | sudo tee /etc/bash_completion.d/tkcli

# .bashrc 확인
grep tkcli ~/.bashrc
</code></pre>
<h2 id="83---">8.3 시스템 환경 문제</h2>
<h3 id="selinux----">SELinux 로 인한 서비스 오류</h3>
<p>TACHYON 서비스가 정상적으로 시작되지 않거나 파일 쓰기 권한 오류가 발생하는 경우 SELinux 설정을 확인하십시오.</p>
<pre><code class="language-bash"># SELinux 상태 확인
tkcli env selinux

# SELinux 를 Permissive 모드로 전환 (로그만 활성, 차단 해제)
tkcli env selinux --set permissive
</code></pre>

    </div>
    

    <div class="footer">
        <p>© 2025 Code Signing Service. All Rights Reserved.</p>
        <p>Document Version: 1.0.0</p>
    </div>

    <!-- Mermaid.js for diagram rendering -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose'
        });
    </script>

</body>

</html>